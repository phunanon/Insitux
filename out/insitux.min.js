(()=>{"use strict";var __webpack_modules__={223:(e,t,r)=>{r.d(t,{Ux:()=>ot,zm:()=>ut});var n=r(728),a=r(376);const s=e=>"bool"===e.t?e.v:"null"!==e.t;function c(e,t,r){const{exactArity:n,maxArity:s,minArity:c}=a.m3[e],u=(n,a)=>[{e:"Arity",m:`${e} needs ${n} argument${1!==a?"s":""}, not ${t}`,errCtx:r}];if(void 0!==n){if(t!==n)return u(`exactly ${n}`,n)}else{if(c&&!s&&t<c)return u(`at least ${c}`,c);if(!c&&s&&t>s)return u(`at most ${s}`,s);if(c&&s&&(t<c||t>s))return u(`between ${c} and ${s}`,s)}}function u(e,t,r,s=!1){const{params:c,numeric:u}=a.m3[e],i=(0,n.len)(t);if(u){const c=t.findIndex((e=>!!(0,n.len)(e)&&(s?!e.find((e=>"num"===e)):"num"!==e[0])));if(-1===c)return;const u=t[c].map((e=>a.O3[e])).join(", ");return[o(`${e} takes numeric arguments only, not ${u}`,r)]}if(!c)return;const l=c.map(((e,r)=>{if(r>=i||!t[r]||"any"===e)return!1;const c=t[r];if((0,n.isArray)(e)){if(s?!(0,n.len)(c)||c.some((t=>(0,n.has)(e,t))):1===(0,n.len)(c)&&(0,n.has)(e,c[0]))return!1;const t=c.map((e=>a.O3[e]));return`argument ${r+1} must be either: ${e.map((e=>a.O3[e])).join(", ")}, not ${t}`}{if(s?!(0,n.len)(c)||(0,n.has)(c,e):1===(0,n.len)(c)&&e===c[0])return!1;const t=c.map((e=>a.O3[e]));return`argument ${r+1} must be ${a.O3[e]}, not ${t}`}})).filter((e=>!!e));return(0,n.len)(l)?l.map((e=>o(e,r))):void 0}const o=(e,t)=>({e:"Type",m:e,errCtx:t});function i(e,t){const r=t.map((e=>a.O3[e])).join(", ");return[o(`number as operation argument must be string, vector, or dictionary, not ${r}`,e)]}function l(e,t){const r=t.map((e=>a.O3[e])).join(", ");return[o(`keyword as operation argument must be dictionary or vector, not ${r}`,e)]}function p({name:e,length:t,captures:r,derefs:a},s,c){if(!(0,n.len)(c))return{name:e,ins:s};const u=[],o=a.map((e=>e.errCtx));for(let e=0;e<t;++e)r[e]?u.push({typ:"val",value:c.shift(),errCtx:o.shift()}):u.push(s[e]);return{name:e,ins:u}}function m(e,t,r){return r&&"val"===t.typ&&"str"===t.value.t&&"exe"===r.typ||"npa"===t.typ&&!(0,n.has)(e,t.text)||"ref"===t.typ&&!(0,n.has)(e,t.value)}const{has:f,flat:d,push:v,slice:y,splice:x}=n,{slen:h,starts:_,sub:C,substr:A,strIdx:b,subIdx:g}=n,{isNum:k,len:O,toNum:E}=n,P={t:"null",v:void 0},I={t:"bool",v:!1},B=e=>!!e&&"errCtx"in e,w=(e,t=0)=>{if(B(e))return"";const r=e[t];return B(r)&&f(["sym","str"],r.typ)&&r.text||""};function M(e){const t=w(e,0),r=f(["#","@"],t);return r&&(e=y(e,1)),`${r?t:""}(${e.map((e=>B(e)?(({typ:e,text:t})=>"str"===e?`"${t}"`:t)(e):M(e))).join(" ")})`}const $=e=>{if(1===O(e))return d(e);const t=e[O(e)-1],r=y(e,0,O(e)-1),n={typ:"pop",value:O(r),errCtx:t[0].errCtx};return d([...r,[n],t])},D=(e,t)=>B(e)?L(e,t):K(e,t);function K(e,t,r=!0){if(!O(e))return[];const s=e=>D(e,t);let u=e.shift(),o=s(u);const{errCtx:i}=o[0];if(B(u)&&"sym"===u.typ){if(u.text in a.m3){const{exactArity:t,minArity:r}=a.m3[u.text],n=t??r;n&&1!==n&&O(e)+1===n&&(e.unshift(u),u={typ:"sym",text:"@",errCtx:u.errCtx})}f(["var","let"],u.text)&&O(e)&&O(e)%2&&(e.unshift(u),e.push({typ:"sym",text:"%",errCtx:u.errCtx}),u={typ:"sym",text:"#",errCtx:u.errCtx});const{text:i,errCtx:l}=u,p=(e,t=l)=>[{typ:"err",value:e,errCtx:t}];if(f(["if","if!","when","unless","match"],i)&&!O(e))return p("provide a condition");if(f(["if","if!"],i)){if(1===O(e))return p("provide at least one branch");if(O(e)>3)return p(`provide one or two branches, not ${O(e)}`);const t=e.map(s),[r,n]=t;let a=t[2];return a||(a=[{typ:"val",value:P,errCtx:l}]),[...r,..."if!"===i&&[{typ:"val",value:{t:"func",v:"!"},errCtx:l},{typ:"exe",value:1,errCtx:l}]||[],{typ:"if",value:O(n)+1,errCtx:l},...n,{typ:"jmp",value:O(a),errCtx:l},...a]}if("when"===i||"unless"===i){if(1===O(e))return p("provide a body");const t=e.map(s),[r,n]=[t[0],y(t,1)],a=$(n);return[...r,..."unless"===i?[{typ:"val",value:{t:"func",v:"!"}},{typ:"exe",value:1}]:[],{typ:"if",value:O(a)+1,errCtx:l},...a,{typ:"jmp",value:1,errCtx:l},{typ:"val",value:P,errCtx:l}]}if("match"===i){const t=e.map(s),[r,n]=[t[0],y(t,1)],a=O(n)%2?n.pop():[];if(!O(n))return p("provide at least one case");const c=O(a);let u=n.reduce(((e,t)=>e+O(t)),0)+(c||2)+O(n);const o=r;for(;O(n)>1;){const[e,t]=[n.shift(),n.shift()];v(o,e),o.push({typ:"mat",value:O(t)+1,errCtx:l}),v(o,t),u-=O(e)+O(t)+2,o.push({typ:"jmp",value:u,errCtx:l})}return O(a)?v(o,a):(o.push({typ:"pop",value:1,errCtx:l}),o.push({typ:"val",value:I,errCtx:l})),o}if("catch"===i){if(O(e)<2)return p("provide at least 2 arguments");const t=s(e.pop());return[...d(e.map(s)),{typ:"cat",value:O(t),errCtx:l},...t]}if("and"===i||"or"===i||"while"===i){const t=e.map(s);if(O(t)<2)return p("provide at least 2 arguments");const r=[];if("while"===i){const[e,n]=[t[0],y(t,1)],a=$(n),s=O(a)+2,c=-(O(e)+O(a)+3);return r.push({typ:"val",value:P,errCtx:l}),v(r,e),r.push({typ:"if",value:s,errCtx:l}),r.push({typ:"pop",value:1,errCtx:l}),v(r,a),r.push({typ:"loo",value:c,errCtx:l}),r}let n=t.reduce(((e,t)=>e+O(t)),0);n+=O(t),n+=E("and"===i);const a="and"===i?"if":"or";for(let e=0;e<O(t);++e)v(r,t[e]),n-=O(t[e]),r.push({typ:a,value:n,errCtx:l}),--n;return"and"===i&&v(r,[{typ:"val",value:{t:"bool",v:!0},errCtx:l},{typ:"jmp",value:1,errCtx:l}]),r.push({typ:"val",value:I,errCtx:l}),r}if("loop"===i){if(O(e)<3)return p("provide at least 3 arguments");const t=e.map(s),r=e[1],n=$(y(t,2));return B(r)?[{typ:"val",value:{t:"num",v:0},errCtx:l},{typ:"let",value:r.text,errCtx:l},...t[0],{typ:"let",value:r.text+"-limit",errCtx:l},{typ:"pop",value:1,errCtx:l},...n,{typ:"ref",value:r.text,errCtx:l},{typ:"val",value:{t:"func",v:"inc"},errCtx:l},{typ:"exe",value:1,errCtx:l},{typ:"let",value:r.text,errCtx:l},{typ:"ref",value:r.text+"-limit",errCtx:l},{typ:"val",value:{t:"func",v:"<"},errCtx:l},{typ:"exe",value:2,errCtx:l},{typ:"if",value:2,errCtx:l},{typ:"pop",value:1,errCtx:l},{typ:"loo",value:-(O(n)+10),errCtx:l}]:p("argument 2 must be symbol")}if("var"===i||"let"===i){const r=e.filter(((e,t)=>!(t%2))),n=e.filter(((e,t)=>!!(t%2)));if(!O(r))return p("provide at least 1 declaration name and value");if(O(r)>O(n))return p("provide a value after each declaration name");const a=[],c=`${i} name must be a new symbol or destructuring`;for(let e=0,u=O(r);e<u;++e){v(a,s(n[e]));const u=r[e];if(B(u)){const n=D(r[e],t);if(O(n)>1||"ref"!==n[0].typ)return p(c,n[0].errCtx);a.push({typ:i,value:n[0].value,errCtx:l})}else{const{shape:e,errors:t}=T([u],!0);if(O(t))return t;if(!O(e))return p(c);const r="var"===i?"dva":"dle";a.push({typ:r,value:e,errCtx:l})}}return a}if("var!"===i||"let!"===i){if(O(e)<2)return p("provide 1 declaration name and 1 function");const t=e.map(s),[r,n,a]=[t[0][0],t[1],y(t,2)];if("ref"!==r.typ)return p("declaration name must be symbol",r.errCtx);const c=[{typ:"ref",value:r.value,errCtx:l}];v(c,[...d(a),...n]),c.push({typ:"exe",value:O(a)+1,errCtx:l});const u="var!"===i?"var":"let";return c.push({typ:u,value:r.value,errCtx:l}),c}if("#"===i||"@"===i||"fn"===i){const r=[],s=M([u,...e]),c=[],o=y(t).map((e=>e.name));let d=!1;if("fn"===i){const n=T(e,!1);if(v(c,n.shape.map((e=>e.name))),v(t,n.shape),v(r,n.errors),!O(e))return p("provide a body");d=1===O(e),e.unshift({typ:"sym",text:"do",errCtx:l})}if("@"===i){const t=w(e,0);if(f(a.RV,t)){const{errCtx:r}=e[0];return p(`"${t}" syntax unavailable in partial closure`,r)}e=[{typ:"sym",text:"...",errCtx:l},...e,{typ:"sym",text:"args",errCtx:l}]}v(r,K(e,t,"@"!==i));const x=r.filter((e=>"err"!==e.typ)),h=r.filter((e=>"err"===e.typ));return O(h)?h:(d&&(x.pop(),x.pop()),[{typ:"clo",value:function(e,t,r,a){const s=[],c=[],u=r;for(let e=0,r=(0,n.len)(a);e<r;++e){const o=a[e];let i=!1;if("clo"!==o.typ)"let"===o.typ||"var"===o.typ?u.push(o.value):m(u,o,e+1!==r&&a[e+1])&&(c.push(o),i=!0),s.push(i);else{s.push(!1);const r=[],u=[];for(let i=0,l=0;i<o.value.length;++i){const p=a[e+1+i],m="npa"===p.typ&&(0,n.has)(t,p.text);s.push(m),u.push(!m&&o.value.captures[i]),m?c.push(o.value.derefs[l++]):o.value.captures[i]&&r.push(o.value.derefs[l++])}o.value.derefs=r,o.value.captures=u,e+=o.value.length}}return{name:e,length:(0,n.len)(a),captures:s,derefs:c}}(s,o,c,x),errCtx:l},...x])}if("->"===i)return K(e.reduce(((e,t)=>[t,e])),t);if(a.m3[i]&&r){const t=c(i,O(e),l),r=(e,t=l)=>[{typ:"err",value:e,errCtx:t}];v(o,t?.map((e=>r(e.m)[0]))??[]),t||2===O(e)&&a.m3[`fast${i}`]&&(o=s({typ:"sym",text:`fast${i}`,errCtx:l}))}}const l=e.map(s),p=d(l);if("return"===w([u]))return[...p,{typ:"ret",value:!!O(l),errCtx:i}];if(1===O(o)&&"ref"===o[0].typ){const{value:e,errCtx:t}=o[0];o[0]={typ:"val",value:{t:"str",v:e},errCtx:t}}v(p,o);const x=O(o)>1||f(["npa","upa"],o[0].typ)?"exa":"exe";return[...p,{typ:x,value:O(l),errCtx:i}]}function L(e,t){if(B(e)){const{errCtx:r}=e;if("str"===e.typ)return[{typ:"val",value:{t:"str",v:e.text},errCtx:r}];if("num"===e.typ)return[{typ:"val",value:{t:"num",v:E(e.text)},errCtx:r}];if("sym"===e.typ){const{text:n}=e,s=t.map((({name:e})=>e));if("true"===n||"false"===n)return[{typ:"val",value:{t:"bool",v:"true"===n},errCtx:r}];if("null"===n)return[{typ:"val",value:P,errCtx:r}];if("_"===n)return[{typ:"val",value:{t:"wild",v:void 0},errCtx:r}];if(_(n,":"))return[{typ:"val",value:{t:"key",v:n},errCtx:r}];if("%"===n||_(n,"%")&&k(A(n,1))){const e="%"===n?0:E(A(n,1));return e<0?[{typ:"val",value:P,errCtx:r}]:[{typ:"upa",value:e,text:n,errCtx:r}]}if(f(s,n)){const e=t.find((({name:e})=>e===n));return 1===O(e.position)?[{typ:"npa",value:e.position[0],text:n,errCtx:r}]:[{typ:"dpa",value:e.position,errCtx:r}]}return"args"===n?[{typ:"upa",value:-1,text:"args",errCtx:r}]:"PI"===n||"E"===n?[{typ:"val",value:{t:"num",v:"PI"===n?3.141592653589793:2.718281828459045},errCtx:r}]:a.m3[n]?[{typ:"val",value:{t:"func",v:n},errCtx:r}]:[{typ:"ref",value:n,errCtx:r}]}return[]}return O(e)?K(e,t):[]}function T(e,t,r=[]){const n=[],a=[];let s=0;for(;O(e)>(t?0:1)&&(B(e[0])||"vec"===w(e[0]));){const t=e.shift();if(B(t)){const{typ:e,errCtx:c}=t;"sym"===e?n.push({name:t.text,position:[...r,s]}):a.push({typ:"err",value:"provide parameter name",errCtx:c})}else{t.shift();const e=T(t,!0,[...r,s]);v(n,e.shape),v(a,e.errors)}++s}return{shape:n,errors:a}}function U({name:e,nodes:t}){const{shape:r,errors:n}=T(t,!1),a=[...n,...d(t.map((e=>L(e,r))))];for(let e=0,t=O(a);e<t;e++){const{typ:t,value:r,errCtx:n}=a[e];if("err"===t)return{e:"Parse",m:r,errCtx:n}}return{name:e,ins:a}}function R(e){const t=[];for(let r=0,n=O(e);r<n;++r){const n=e[r];switch(n.typ){case"val":t.push({types:[n.value.t],val:n.value});break;case"exa":case"exe":{const e=t.pop(),r=x(t,O(t)-n.value,n.value),s=e=>r.findIndex((({types:t})=>t&&!e.find((e=>f(t,e))))),c=t=>e.val?e.val.t===t:e.types&&1===O(e.types)&&e.types[0]===t;if(e.val&&"func"===e.val.t){if("recur"===e.val.v){x(t,O(t)-n.value,n.value);break}const s=u(e.val.v,r.map((e=>e.types??[])),n.errCtx,!0);if(s)return s;const{returns:c,numeric:o}=a.m3[e.val.v];t.push(o&&"in only"!==o?{types:["num"]}:{types:c})}else if(c("num")){const e=s(["str","dict","vec"]);if(-1!==e)return i(n.errCtx,r[e].types);t.push({})}else if(c("key")){const e=s(["dict","vec"]);if(-1!==e)return l(n.errCtx,r[e].types);t.push({})}else c("str")||c("bool")?t.push({}):e.types||e.val||t.push({});break}case"or":t.pop(),t.push({}),r+=n.value;break;case"cat":case"var":case"let":case"dva":case"dle":case"loo":case"jmp":break;case"clo":{const a=R(y(e,r+1,r+n.value.length));if(a)return a;t.push({})}case"ref":case"npa":case"upa":case"dpa":t.push({});break;case"if":{t.pop(),t.push({});const a=R(y(e,r+1,n.value+1));if(a)return a;r+=n.value-1;break}case"mat":t.pop(),t.pop(),r+=n.value,r+=e[r].value,t.push({});break;case"pop":x(t,O(t)-n.value,n.value);break;case"ret":n.value&&t.pop();break;default:(0,a.UT)(n)}}}function W(e,t){const{tokens:r,stringError:n}=function(e,t,r=!0,n=!1){const a=[],s=e=>C("0123456789",e);let[c,u,o,i]=[!1,1,0,[1,0]],[l,p,m]=[!1,!1,!1];for(let f=0,d=h(e);f<d;++f){const v=b(e,f),y=f+1!==d?b(e,f+1):"";if(++o,"\\"===v&&c){a[O(a)-1].text+=r?{n:"\n",t:"\t",r:"\r",'"':'"'}[y]||("\\"===y?"\\":`\\${y}`):`\\${y}`,++o,++f;continue}const x={invokeId:t,line:u,col:o};if('"'===v){(c=!c)&&(i=[u,o],a.push({typ:"str",text:"",errCtx:x})),p=l=!1;continue}const _=C(" \t\n\r,",v);if(!c&&_){l=!1,p&&(p=","===v),"\n"===v&&(++u,o=0);continue}if(!c&&";"===v){const t=g(A(e,++f),"\n"),r=A(e,f,t>0?t:d-f);f+=h(r),++u,o=0,n&&a.push({typ:"rem",text:r,errCtx:x});continue}const k=C("()[]{}",v);if(p&&!s(v)){const e="x"===v&&"0"===a[O(a)-1].text;m=m||e,p="b"===v&&"0"===a[O(a)-1].text||"."===v&&!C(a[O(a)-1].text,".")||m&&(e||C("ABCDEFabcdef",v)),p||k||_||(l=!0,a[O(a)-1].typ="sym")}if(l&&k&&(l=!1),!c&&!l&&!p){if(k){const e=-1===g("[{(",v)?")":"(";a.push({typ:e,text:r?e:v,errCtx:x}),!r||"["!==v&&"{"!==v||a.push({typ:"sym",text:"["===v?"vec":"dict",errCtx:x});continue}p=s(v)||"."===v&&s(y)||"-"===v&&(s(y)||"."===y),m=l=!p;const e=l?"sym":"num";a.push({typ:e,text:"",errCtx:x})}a[O(a)-1].text+=v}return{tokens:a,stringError:c?i:void 0}}(e,t),a=function(e,t){const r=O(t)?t[0].errCtx.invokeId:"",n=[],a=(e,t)=>n.push({e:"Parse",m:e,errCtx:t});if(e){const[t,s]=e;return a("unmatched double quotation marks",{invokeId:r,line:t,col:s}),n}const s=e=>O(t.filter((({typ:t})=>t===e))),[c,u]=[s("("),s(")")];{const[e,n]=function(e,t,r){const n=r>=t,[a,s]=[n?"(":")",n?")":"("],c=n?1:-1;for(let t=O(e),r=n?0:t-1,u=0;n?r<t:r>=0;r+=c){const{typ:t,errCtx:{line:n,col:c}}=e[r];if(u+=E(t===a)-E(t===s),u<0)return[n,c]}return[0,0]}(t,c,u);e+n&&a("unmatched parenthesis",{invokeId:r,line:e,col:n})}let o;for(let e=0,r=!1;e<O(t);++e){if(r&&")"===t[e].typ){o=t[e];break}r="("===t[e].typ}return o&&a("empty expression forbidden",o.errCtx),n}(n,r);if(O(a))return{errors:a,funcs:{}};const s=[],c=[],u=function(e){const t=[],r=[];return e.forEach((e=>{if(!B(e)&&B(e[0])&&"function"===w(e)){const r=w(e,1);r?O(e)<3&&t.push({err:"empty function body",errCtx:e[0].errCtx}):t.push({err:"nameless function",errCtx:e[0].errCtx}),t.push({name:r,nodes:y(e,2)})}else r.push(e)})),O(r)&&t.push({name:"entry",nodes:r}),t}(function(e){const t=[],r=e=>{let t;"sym"===e[0].typ&&C("@#",e[0].text)&&(t=e.shift());const n=e.shift();if("("!==n.typ&&")"!==n.typ)return n;const a=t?[t]:[];for(;")"!==e[0].typ;)a.push(r(e));return e.shift(),a};for(;O(e);)t.push(r(e));return t}(y(r))),o=[];u.forEach((e=>{"err"in e?c.push({e:"Parse",m:e.err,errCtx:e.errCtx}):o.push({name:e.name,nodes:e.nodes})})),o.map(U).forEach((e=>{"e"in e?c.push(e):s.push(e)})),v(c,d(s.map((e=>R(e.ins)??[]))));const i={};return s.forEach((e=>i[e.name??""]=e)),{errors:c,funcs:i}}function j(e,t){return e.dict.has(t)?{kind:"val",value:e.dict.get(t)}:{kind:"err",err:`"${t}" not found.`}}function S(e,t,r){e.dict.set(t,r)}function q(e,t,r){switch(t){case"test.function":e.output+=r[0].v+"\n";break;default:return{kind:"err",err:`operation "${t}" does not exist`}}return{kind:"val",value:{t:"null",v:void 0}}}const N=[{name:"Hello, world!",code:'"Hello, world!"',out:"Hello, world!"},{name:"Say Hello, world!",code:';This is a test comment\n           (print "Hello, world!")',out:"Hello, world!\nnull"},{name:"1 + 1 = 2",code:"(+ 1 1)",out:"2"},{name:"Negate 1 = -1",code:"(- 1)",out:"-1"},{name:"(1+1)+1+(1+1) = 5",code:"(+ (+ 1 1) 1 (+ 1 1))",out:"5"},{name:"Conditional head",code:"((if true + -) 12 9 1)",out:"22"},{name:"when and unless",code:'[(when 123 (print "hi") 234) (unless true (print "bye"))]',out:"hi\n[234 null]"},{name:"match and wildcard",code:'(match [1 2]\n             [0 0] (print "hello")\n             [0 2] (print "bye")\n             [1 _] "hey")',out:"hey"},{name:"Cond number head",code:"((if false 1 2) [:a :b :c])",out:":c"},{name:"and & short-circuit",code:'[(and true (if true null 1) (print "hi")) (and 1 2 3)]',out:"[false true]"},{name:"or & short-circuit",code:'[(or true (print "hi") 1) (or false (print-str "-> ") 1)]',out:"-> [true 1]"},{name:"String retrieve",code:'(2 "Hello")',out:"l"},{name:"Vector retrieve",code:"(2 [:a :b :c :d])",out:":c"},{name:"Key as operation",code:'[(:age {:name "Patrick" :age 24}) (:abc [:a :abc :c])]',out:"[24 :abc]"},{name:"Dictionary as op 1",code:'({"name" "Patrick" "age" 24} "age")',out:"24"},{name:"Dictionary as op 2",code:'({"name" "Patrick"} "age" 24)',out:'{"name" "Patrick", "age" 24}'},{name:"Equalities",code:'[(= 1 2 1)\n            (!= 1 2 1)\n            (= "Hello" "hello")\n            (!= "world" "world")\n            (= [0 [1]] [0 [1]])]',out:"[false true false false true]"},{name:"Define and retrieve",code:"(var a 1) a",out:"1"},{name:"Define and add",code:"(var a 1) (inc a)",out:"2"},{name:"Define op and call",code:"(var f +) (f 2 2)",out:"4"},{name:"Define vec and call",code:"(var f [1]) (f 1)",out:"1"},{name:"Define num and call",code:"(var f 1) (f [:a :b :c])",out:":b"},{name:"Apply op to var",code:"(var a 10) (var! a + 10)",out:"20"},{name:"Apply op to let",code:"(let a 10) (let! a (if true + -) (+ 2 3) 5)",out:"20"},{name:"Print simple vector",code:"[1 2 3]",out:"[1 2 3]"},{name:"Boolean select",code:"[(true 1 2) (false 1)]",out:"[1 null]"},{name:"Sum vector of numbers",code:"[(reduce + [1 2 3]) (reduce + 3 [1 2 3])]",out:"[6 9]"},{name:"Sum vectors of numbers",code:"(map + [1 2 3] [1 2 3 4])",out:"[2 4 6]"},{name:"For XY list",code:"(for vec [0 1] [0 1])",out:"[[0 0] [1 0] [0 1] [1 1]]"},{name:"Filter by integer",code:'(filter 2 [[1] [:a :b :c] "hello" "hi"])',out:'[[:a :b :c] "hello"]'},{name:"Comments, short decimal",code:';((print "Hello")\n           .456',out:"0.456"},{name:"Dictionary into vector",code:"(into [1 2] {3 4 5 6})",out:"[1 2 [3 4] [5 6]]"},{name:"Vector into dictionary",code:"(into {[0] 1 [2] 3} [[0] 2])",out:"{[0] 2, [2] 3}"},{name:"While loop",code:"(var n 5)\n           (while (< 0 n)\n             (print-str n)\n             (var n (dec n)))",out:"543210"},{name:"Loop",code:"(loop 3 i (print-str i))",out:"012null"},{name:"Catch error",code:'(catch\n             (:e (catch (let a :a) (+ 1 a) (0 errors)))\n             (print "hi"))',out:"Type"},{name:"Define with no call",code:'(function func (print "Nothing."))'},{name:"Call greet func",code:'(function greeting (print "Hello!")) (greeting)',out:"Hello!\nnull"},{name:"Call const value func",code:"(function const 123) (const)",out:"123"},{name:"Call identity funcs",code:"(function id1 %)\n           (function id2 x x)\n           [(id1 123) (id2 456)]",out:"[123 456]"},{name:"Call greet with name",code:'(function greeting name (print "Hello, " name "!"))\n           (greeting "Patrick")',out:"Hello, Patrick!\nnull"},{name:"Call with too few args",code:"(function func a b c [a b c]) (func 1 2)",out:"[1 2 null]"},{name:"Define func and call",code:"(function func a b (+ a b)) (var f func) (f 2 2)",out:"4"},{name:"Anonymous parameters",code:"(function avg<n? (< (/ (.. + %) (len %)) %1))\n           (avg<n? [0 10 20 30 40] 5)",out:"false"},{name:"Call parameter",code:'(function f x (x "hello")) (f print)',out:"hello\nnull"},{name:"Let and retrieve",code:"(function f (let a 1) a) (f)",out:"1"},{name:"Let num op and call",code:"(function f (let n 0) (n [1])) (f)",out:"1"},{name:"Explicit return",code:"(function f (return 123) (print 456)) (f)",out:"123"},{name:"Closure 1",code:"(let x 10)\n           (let closure #(+ x x))\n           (let x 11)\n           (closure)",out:"20"},{name:"Closure 2",code:"(filter #(or (.. = args) (even? %)) (range 10) 5)",out:"[0 2 4 5 6 8]"},{name:"Closure 3",code:"(function f #(+ x x))\n           (var x 10) (let c20 (f))\n           (var x 20) (let c40 (f))\n           [(c20) (c40)]",out:"[20 40]"},{name:"Closure with ext func",code:"(#(test.function %) 1)",out:"1\nnull"},{name:"Func returns closure",code:"(function f x #(x 2 2))\n           (let closure (f +))\n           (closure)",out:"4"},{name:"Dictionary closure",code:"(function f x #{x 2})\n           (let closure (f :a))\n           (closure)",out:"{:a 2}"},{name:"Vector closure",code:"(function f x #[1 x %])\n           (let closure (f 2))\n           (closure 3)",out:"[1 2 3]"},{name:"Closure as head",code:"(#[% %1 %2] 1 2 3)",out:"[1 2 3]"},{name:"Partial closure 1",code:"(@[] 1 2 3)",out:"[1 2 3]"},{name:"Partial closure 2",code:"(@((do +) 2) 2)",out:"4"},{name:"Parameterised closure 1",code:"((fn a b (+ a b)) 2 2)",out:"4"},{name:"Parameterised closure 2",code:"((fn a b (print-str a b) (+ a b)) 2 2)",out:"224"},{name:"Parameterised closure 3",code:"(reduce\n             (fn primes num\n               (if (find zero? (map (rem num) primes))\n                 primes\n                 (append num primes)))\n             [2]\n             (range 3 10))",out:"[2 3 5 7]"},{name:"Closure with inter-lets",code:"(let a + c 5 d 10)\n           (let closure (fn b (let d 1) (a b c d)))\n           (let a - c 4 d 11)\n           (closure 1)",out:"7"},{name:"Closure with inner-let",code:"(((fn x (let y 1) #[x y]) 2))",out:"[2 1]"},{name:"Closure with captured f",code:"[((fn x (@(val x))) 0) (var f val) ((fn y (@(f y))) 0)]",out:"[0 val 0]"},{name:"Closure w/ inter-params",code:"(function f x (fn y (fn z [x y z]))) (((f :a) :b) :c)",out:"[:a :b :c]"},{name:"Destructure var",code:"(var [x [y]] [1 [2]]) [y x]",out:"[2 1]"},{name:"Destructure string",code:'(let [a b c] "hello") [a b c]',out:'["h" "e" "l"]'},{name:"Destructure function",code:"(function f a [[b c] d] e [e d c b a]) (f 0 [[1 2] 3] 4)",out:"[4 3 2 1 0]"},{name:"Destructuring closure",code:"(let f (fn a [b [c]] d [d c b a])) (f 0 [1 [2]] 3)",out:"[3 2 1 0]"},{name:"Destructuring fn decoy",code:"(let f (fn a [a [a]])) (f 0)",out:"[0 [0]]"},{name:"Implicit currying",code:"(-> 1 inc (+ 10))",out:"12"},{name:"String instead of number",code:'(function sum (.. + args))\n           (print (sum 2 2))\n           (sum 2 "hi")',out:"4",err:["Type"]},{name:"Reference non-existing",code:"x",err:["Reference"]},{name:"Expired let retrieve",code:"(function f (let a 1) a) (f) a",err:["Reference"]},{name:"Call non-existing",code:"(x)",err:["External"]},{name:"Call budget",code:"(function f (f)) (f)",err:["Budget"]},{name:"Loop budget",code:"(var n 10000)\n           (while (< 0 n)\n             (var n (dec n)))",err:["Budget"]},{name:"Range budget",code:"(range 10000)",err:["Budget"]},{name:"Head exe arity check",code:"(((fn +)) 1)",err:["Arity"]},{name:"Fibonacci 13",code:"(function fib n\n             (if (< n 2) n\n               (+ (fib (dec n))\n                  (fib (- n 2)))))\n           (fib 13)",out:"233"},{name:"dedupe (recur)",code:"(function dedupe list -out\n             (let out (or -out []))\n             (let next (if (out (0 list)) [] [(0 list)]))\n             (if (empty? list) out\n                 (recur (sect list) (into out next))))\n           (dedupe [1 1 2 3 3 3])",out:"[1 2 3]"},{name:"frequencies",code:'(function frequencies list\n             (reduce #(% %1 (inc (or (% %1) 0))) {} list))\n           (frequencies "12121212")',out:'{"1" 4, "2" 4}'},{name:"set get",code:"[($globals.time_offset 5.5) $globals.time_offset]",out:"[5.5 5.5]"},{name:"exe",code:"(test.function 123)",out:"123\nnull"},{name:"Empty parens",code:"()",err:["Parse"]},{name:"Imbalanced parens 1",code:'(print ("hello!")',err:["Parse"]},{name:"Imbalanced parens 2",code:'print "hello!")',err:["Parse"]},{name:"Imbalanced quotes",code:'(print "Hello)',err:["Parse"]},{name:"Function as op",code:"(function)",err:["Parse"]},{name:"Function without name",code:"(function (+))",err:["Parse"]},{name:"Function without body",code:"(function func)",err:["Parse"]},{name:"Variable not symbol",code:"(var 1 2)",err:["Parse"]},{name:"Parser type error 1",code:"(function f (+ 1 :a))",err:["Type"]},{name:"Parser type error 2",code:"(function f (+ 1 (into {} {})))",err:["Type"]},{name:"Parser type error 3",code:"(function f (if true (into 2 {}) (+ 2 2)))",err:["Type"]},{name:"Parser arity error 1",code:"(abs)",err:["Parse"]}];var H=r(183);const{abs:V,sign:z,sqrt:X,floor:F,ceil:G,round:J,max:Y,min:Q,logn:Z,log2:ee,log10:te}=n,{cos:re,sin:ne,tan:ae,acos:se,asin:ce,atan:ue,sinh:oe,cosh:ie,tanh:le}=n,{concat:pe,has:me,flat:fe,push:de,reverse:ve,slice:ye,splice:xe,sortBy:he}=n,{ends:_e,slen:Ce,starts:Ae,sub:be,subIdx:ge,substr:ke,upperCase:Oe,lowerCase:Ee}=n,{trim:Pe,trimStart:Ie,trimEnd:Be,strIdx:we,replace:Me,rreplace:$e}=n,{charCode:De,codeChar:Ke,getTimeMs:Le,randInt:Te,randNum:Ue}=n,{isNum:Re,len:We,objKeys:je,range:Se,toNum:qe,isArray:Ne}=n;let He,Ve=[],ze={};function Xe(e){throw{errors:e}}function Fe(e){return!!e&&"object"==typeof e&&"errors"in e}const Ge=(e,t)=>Xe([o(e,t)]);const Je=(e,t)=>[{e:"Arity",m:`${a.O3[e]} as operation requires one sole argument`,errCtx:t}];function Ye(e,t,r,n){if(n){const n=c(e,We(t),r);if(n)return n}return u(e,t.map((e=>[e.t])),r)||!1}function Qe(e,t,r,c=!0){if("str"===t.t||"func"===t.t){const u=t.v;return a.m3[u]?a.m3[u].external?t=>{const n=Ye(u,t,r,c);n&&Xe(n);const a=e.functions[u].handler(t);return"err"===a.kind?Xe([{e:"External",m:a.err,errCtx:r}]):a.value}:t=>{const o=Ye(u,t,r,c);return o&&Xe(o),function(e,t,r,c){switch(e){case"str":return(0,H.fL)((0,H.Pz)(t));case"strn":return(0,H.fL)((0,H.Pz)(t.filter((e=>"null"!==e.t))));case"print":case"print-str":return r.print((0,H.Pz)(t),"print"===e),(0,H.cC)();case"vec":return(0,H.IO)(t);case"dict":return(0,H.gu)(t);case"len":return(0,H.kC)("str"===t[0].t?Ce(t[0].v):"vec"===t[0].t?We(t[0].v):We((0,H.Ay)(t[0]).keys));case"to-num":return Re(t[0].v)?(0,H.kC)(qe(t[0].v)):(0,H.cC)();case"to-key":return(0,H.SN)(`:${(0,H.aP)(t[0])}`);case"to-vec":return(0,H.IO)((0,H._2)(t[0]));case"!":return(0,H.Uc)(!s(t[0]));case"=":case"!=":for(let r=1,n=We(t);r<n;++r)if((0,H.Xy)(t[r-1],t[r])!==("="===e))return(0,H.Uc)(!1);return(0,H.Uc)(!0);case"-":return(0,H.kC)(1===We(t)?-(0,H.OK)(t[0]):t.map(H.OK).reduce(((e,t)=>e-t)));case"**":return(0,H.kC)((0,H.OK)(t[0])**(1===We(t)?2:(0,H.OK)(t[1])));case"+":return(0,H.kC)(t.map(H.OK).reduce(((e,t)=>e+t)));case"*":return(0,H.kC)(t.map(H.OK).reduce(((e,t)=>e*t)));case"/":return(0,H.kC)(t.map(H.OK).reduce(((e,t)=>e/t)));case"//":return(0,H.kC)(t.map(H.OK).reduce(((e,t)=>F(e/t))));case"fast=":case"fast!=":return(0,H.Uc)((0,H.Xy)(t[0],t[1])===("fast="===e));case"fast-":return(0,H.kC)(t[0].v-t[1].v);case"fast+":return(0,H.kC)(t[0].v+t[1].v);case"fast*":return(0,H.kC)(t[0].v*t[1].v);case"fast/":return(0,H.kC)(t[0].v/t[1].v);case"fast//":return(0,H.kC)(F(t[0].v/t[1].v));case"fast<":return(0,H.Uc)(t[0].v<t[1].v);case"fast>":return(0,H.Uc)(t[0].v>t[1].v);case"fast<=":return(0,H.Uc)(t[0].v<=t[1].v);case"fast>=":return(0,H.Uc)(t[0].v>=t[1].v);case"rem":return(0,H.kC)(t.map(H.OK).reduce(((e,t)=>e%t)));case"min":return(0,H.kC)(t.map(H.OK).reduce(((e,t)=>Q(e,t))));case"max":return(0,H.kC)(t.map(H.OK).reduce(((e,t)=>Y(e,t))));case"<":case">":case"<=":case">=":for(let r=1,n=We(t);r<n;++r){const[n,a]=[t[r-1].v,t[r].v];if("<"===e&&n>=a||">"===e&&n<=a||"<="===e&&n>a||">="===e&&n<a)return(0,H.Uc)(!1)}return(0,H.Uc)(!0);case"inc":return(0,H.kC)(t[0].v+1);case"dec":return(0,H.kC)(t[0].v-1);case"abs":return(0,H.kC)(V(t[0].v));case"round":if(2===We(t)){const e=10**t[0].v;return(0,H.kC)(J(t[1].v*e)/e)}return(0,H.kC)(J(t[0].v));case"sin":case"cos":case"tan":case"sqrt":case"floor":case"ceil":case"logn":case"log2":case"log10":{const r={sin:ne,cos:re,tan:ae,sqrt:X,floor:F,ceil:G,logn:Z,log2:ee,log10:te}[e];return(0,H.kC)(r((0,H.OK)(t[0])))}case"asin":case"acos":case"atan":case"sinh":case"cosh":case"tanh":{const r={asin:ce,acos:se,atan:ue,sinh:oe,cosh:ie,tanh:le}[e];return(0,H.kC)(r((0,H.OK)(t[0])))}case"and":return(0,H.Uc)(t.every(s));case"or":return(0,H.Uc)(t.some(s));case"xor":return s(t[0])!==s(t[1])?s(t[0])?t[0]:t[1]:(0,H.Uc)(!1);case"&":case"|":case"^":case"<<":case">>":case">>>":const[u,o]=[(0,H.OK)(t[0]),(0,H.OK)(t[1])];return(0,H.kC)("&"===e?u&o:"|"===e?u|o:"^"===e?u^o:"<<"===e?u<<o:">>"===e?u>>o:u>>>o);case"~":return(0,H.kC)(~(0,H.OK)(t[0]));case"odd?":case"even?":return(0,H.Uc)((0,H.OK)(t[0])%2==("odd?"===e?1:0));case"pos?":case"neg?":case"zero?":{const r=(0,H.OK)(t[0]);return(0,H.Uc)("pos?"===e?r>0:"neg?"===e?r<0:!r)}case"null?":case"num?":case"bool?":case"str?":case"dict?":case"vec?":case"key?":case"func?":case"wild?":case"ext?":{const{t:r}=t[0];return(0,H.Uc)("func?"===e&&("func"===r||"clo"===r)||ke(e,0,Ce(e)-1)===r)}case"type-of":return(0,H.fL)(t[0].t);case"substr?":return(0,H.Uc)(be((0,H.Bd)(t[1]),(0,H.Bd)(t[0])));case"idx":{let e=-1;return"str"===t[0].t?"str"!==t[1].t?Ge("strings can only contain strings",c):e=ge(t[1].v,t[0].v):"vec"===t[0].t&&(e=t[0].v.findIndex((e=>(0,H.Xy)(e,t[1])))),-1===e?(0,H.cC)():(0,H.kC)(e)}case"set-at":{const[e,r,n]=t;return(0,H.WW)((0,H.Bh)(e),r,n)}case"map":case"for":case"reduce":case"reductions":case"filter":case"remove":case"find":case"count":{const n=Qe(r,t.shift(),c);if("map"===e||"for"===e){const e=t.findIndex((({t:e})=>"vec"!==e&&"str"!==e&&"dict"!==e));if(-1!==e){const r=a.O3[t[e].t];Ge(`argument ${e+2} must be either: string, vector, dictionary, not ${r}`,c)}}if("for"===e){const e=t.map(H._2),a=e.map(We),s=a.map(((e,t)=>ye(a,0,t+1).reduce(((e,t)=>e*t))));s.unshift(1);const u=s.pop();u>r.loopBudget&&Xe([{e:"Budget",m:"would exceed loop budget",errCtx:c}]);const o=[];for(let t=0;t<u;++t){const r=s.map(((e,r)=>F(t/e%a[r])));o.push(n(e.map(((e,t)=>e[r[t]]))))}return(0,H.IO)(o)}if("map"===e){const e=t.map(H._2),r=Q(...e.map(We)),a=[];for(let t=0;t<r;++t)a.push(n(e.map((e=>e[t]))));return(0,H.IO)(a)}if("reduce"!==e&&"reductions"!=e){const r=t.shift(),a=(0,H._2)(r),c="remove"===e,u="find"===e,o="count"===e,i=[];let l=0;for(let e=0,r=We(a);e<r;++e){const r=s(n([a[e],...t]));if(o)l+=r?1:0;else if(u){if(r)return a[e]}else r!==c&&i.push(a[e])}switch(e){case"count":return(0,H.kC)(l);case"find":return(0,H.cC)()}return"str"===r.t?(0,H.fL)(i.map((e=>(0,H.aP)(e))).join("")):"dict"===r.t?(0,H.gu)(fe(i.map((e=>e.v)))):(0,H.IO)(i)}const u=t.pop();me(["vec","dict","str"],u.t)||Ge(`must reduce either: string, vector, dictionary, not ${a.O3[u.t]}`,c);const o=(0,H._2)(u);if(!We(o))return We(t)?t[0]:(0,H.IO)();if(We(o)<2&&!We(t))return o[0];let i=(We(t)?t:o).shift();if("reductions"===e){const e=[];for(let t=0,r=We(o);t<r;++t)e.push(i),i=n([i,o[t]]);return e.push(i),(0,H.IO)(e)}for(let e=0,t=We(o);e<t;++e)i=n([i,o[e]]);return i}case"repeat":{const e=t.shift(),n=[],a=(0,H.OK)(t[0]);if(a>r.rangeBudget&&Xe([{e:"Budget",m:"would exceed range budget",errCtx:c}]),r.rangeBudget-=a,"func"===e.t||"clo"===e.t){const t=Qe(r,e,c);for(let e=0;e<a;++e)n.push(t([(0,H.kC)(e)]))}else for(let t=0;t<a;++t)n.push(e);return(0,H.IO)(n)}case"rand-int":case"rand":{const r=We(t),[n,a]=[r<2?0:(0,H.OK)(t[0]),0===r?1+qe("rand-int"===e):1===r?(0,H.OK)(t[0]):(0,H.OK)(t[1])];return(0,H.kC)("rand-int"===e?Te(n,a):Ue(n,a))}case"do":case"val":return"do"===e?t.pop():t.shift();case".":case"..":case"...":{const n=Qe(r,t.shift(),c);if("."===e)return n(t);let a=t;if(".."===e)a=fe(t.map((e=>"vec"===e.t?e.v:[e])));else{const e=a.pop();de(a,fe(["vec"===e.t?e.v:[e]]))}return n(a)}case"into":if("vec"===t[0].t)return(0,H.IO)(pe(t[0].v,(0,H._2)(t[1])));if("vec"===t[1].t)return(0,H.gu)(pe(fe((0,H._2)(t[0]).map(H.Bh)),t[1].v));{const{keys:e,vals:r}=(0,H.Ay)(t[0]),{keys:n,vals:a}=(0,H.Ay)(t[1]);return(0,H.L6)({keys:pe(e,n),vals:pe(r,a)})}case"omit":return(0,H.uv)((0,H.Ay)(t[1]),t[0]);case"assoc":return(0,H.L6)((0,H.bd)((0,H.Ay)(t[2]),t[0],t[1]));case"append":return(0,H.IO)(pe((0,H.Bh)(t[1]),[t[0]]));case"prepend":return(0,H.IO)(pe([t[0]],(0,H.Bh)(t[1])));case"insert":{const e=(0,H.Bh)(t[2]);let r=(0,H.OK)(t[1]);return 0===r?(0,H.IO)(pe([t[0]],e)):-1===r?(0,H.IO)(pe(e,[t[0]])):(r=r>0?Q(r,We(e)):Y(We(e)+1+r,0),(0,H.IO)(pe(pe(ye(e,0,r),[t[0]]),ye(e,r))))}case"sect":{const e=t[0],r="vec"===e.t?We(e.v):Ce((0,H.Bd)(e));let n=0,a=r;switch(We(t)){case 1:n=1;break;case 2:{const e=(0,H.OK)(t[1]);e<0?a+=e:n+=e;break}case 3:{const e=(0,H.OK)(t[1]),s=(0,H.OK)(t[2]);n=e<0?r+e+(s<0?s:0):n+e,a=(s<0?a:n)+s;break}}return n=Y(n,0),a=Q(a,r),n>a?("vec"===e.t?H.IO:H.fL)():"vec"===e.t?(0,H.IO)(ye(e.v,n,a)):(0,H.fL)(ke((0,H.Bd)(t[0]),n,a-n))}case"skip":case"first":case"last":case"crop":{const r=Y(0,(0,H.OK)(t[0])),{t:n,v:a}=t["crop"===e?2:1],s="str"===n?Ce(a):We(a);let c="first"===e?0:"last"===e?s-r:r;const u="first"===e?r:"crop"===e?s-Y(0,(0,H.OK)(t[1])):s;return c=c>u?u:c,"str"===n?(0,H.fL)(ke(a,c,u-c)):(0,H.IO)(ye(a,c,u))}case"reverse":return"str"===t[0].t?(0,H.fL)((0,H.Pz)(ve((0,H._2)(t[0])))):(0,H.IO)(ve((0,H._2)(t[0])));case"flatten":{const e=(0,H.Bh)(t[0]),r=[],n=e=>e.forEach((e=>"vec"===e.t?n(e.v):r.push(e)));return n(e),(0,H.IO)(r)}case"shuffle":{const e=ye((0,H.Bh)(t[0]));for(let t=We(e)-1;t;--t){const r=F(Te(0,t+1));[e[t],e[r]]=[e[r],e[t]]}return(0,H.IO)(e)}case"sample":{const e=ye((0,H.Bh)(t[1])),r=Y(0,Q(We(e),(0,H.OK)(t[0]))),n=We(e)-r;for(let t=We(e)-1;t>n;--t){const r=F(Te(0,t+1));[e[t],e[r]]=[e[r],e[t]]}return(0,H.IO)(ye(e,n))}case"sort":case"sort-by":{const n=(0,H._2)(t["sort"===e?0:1]);if(!We(n))return(0,H.IO)();const a=[];if("sort"===e)de(a,n.map((e=>[e,e])));else{const e=Qe(r,t[0],c);for(let t=0,r=We(n);t<r;++t)a.push([n[t],e([n[t]])])}const s=a[0][1].t;return a.some((([e,{t}])=>t!==s||!me(["num","str"],t)))&&Ge("can only sort by all number or all string",c),he(a,"num"===s?([e,t],[r,n])=>(0,H.OK)(t)>(0,H.OK)(n)?1:-1:([e,t],[r,n])=>(0,H.Bd)(t)>(0,H.Bd)(n)?1:-1),(0,H.IO)(a.map((([e])=>e)))}case"group-by":{const e=Qe(r,t[0],c),n={keys:[],vals:[]};if("dict"===t[1].t){const{keys:r,vals:a}=(0,H.Ay)(t[1]);for(let t=0,s=We(r);t<s;++t){const s=e([r[t],a[t]]),c=n.keys.findIndex((e=>(0,H.Xy)(e,s)));if(-1===c)n.keys.push(s),n.vals.push((0,H.L6)({keys:[r[t]],vals:[a[t]]}));else{const e=(0,H.Ay)(n.vals[c]);e.keys.push(r[t]),e.vals.push(a[t])}}}else{const r=(0,H._2)(t[1]);for(let t=0,a=We(r);t<a;++t){const a=e([r[t]]),s=n.keys.findIndex((e=>(0,H.Xy)(e,a)));-1===s?(n.keys.push(a),n.vals.push((0,H.IO)([r[t]]))):(0,H.Bh)(n.vals[s]).push(r[t])}}return(0,H.L6)(n)}case"part-by":{const e=Qe(r,t[0],c);if("dict"===t[1].t){const{keys:r,vals:n}=(0,H.Ay)(t[1]),a=[{keys:[],vals:[]},{keys:[],vals:[]}];for(let t=0,c=We(r);t<c;++t){const c=s(e([r[t],n[t]]))?0:1;a[c].keys.push(r[t]),a[c].vals.push(n[t])}return(0,H.IO)(a.map(H.L6))}{const r=(0,H._2)(t[1]),n=[[],[]];for(let t=0,a=We(r);t<a;++t)n[s(e([r[t]]))?0:1].push(r[t]);return(0,H.IO)(n.map(H.IO))}}case"freqs":{const e=(0,H._2)(t[0]),r=[],n=[];return e.forEach((e=>{const t=r.findIndex((t=>(0,H.Xy)(e,t)));-1!==t?++n[t]:(r.push(e),n.push(1))})),(0,H.L6)({keys:r,vals:n.map(H.kC)})}case"distinct":{const e=1===We(t)&&"vec"===t[0].t?(0,H.Bh)(t[0]):t,r=[];return e.forEach((e=>{r.some((t=>(0,H.Xy)(e,t)))||r.push(e)})),(0,H.IO)(r)}case"range":{const[e,n,a]=t.map(H.OK),s=a&&a<0&&e<n,[u,o]=We(t)>1?s?[n-1,e-1]:[e,n]:[0,e],i=z((o-u)*(a||1))*(a||1),l=G(V((o-u)/i));if(!l)return(0,H.IO)();l>r.rangeBudget&&Xe([{e:"Budget",m:"would exceed range budget",errCtx:c}]),r.rangeBudget-=l;const p=Se(l).map((e=>e*i+u));return(0,H.IO)(p.map(H.kC))}case"empty?":return(0,H.Uc)(!We((0,H._2)(t[0])));case"keys":case"vals":return(0,H.IO)((0,H.Ay)(t[0])["keys"===e?"keys":"vals"]);case"split":return(0,H.IO)((0,H.Bd)(t[1]).split((0,H.Bd)(t[0])).map(H.fL));case"join":return(0,H.fL)((0,H._2)(t[1]).map(H.aP).join((0,H.Bd)(t[0])));case"replace":case"rreplace":{const r="replace"===e?Me:$e;return(0,H.fL)(r((0,H.Bd)(t[2]),(0,H.Bd)(t[0]),(0,H.Bd)(t[1])))}case"starts?":case"ends?":return(0,H.Uc)(("starts?"===e?Ae:_e)((0,H.Bd)(t[1]),(0,H.Bd)(t[0])));case"upper-case":case"lower-case":case"trim":case"trim-start":case"trim-end":return(0,H.fL)(("upper-case"===e?Oe:"lower-case"===e?Ee:"trim"===e?Pe:"trim-start"===e?Ie:Be)((0,H.Bd)(t[0])));case"str*":{const e=(0,H.Bd)(t[0]);return(0,H.fL)(Se(Y(G((0,H.OK)(t[1])),0)).map((t=>e)).join(""))}case"char-code":if("str"===t[0].t){const e=We(t)>1?(0,H.OK)(t[1]):0,r=(0,H.Bd)(t[0]);return Ce(r)<=e||e<0?(0,H.cC)():(0,H.kC)(De(we(r,e)))}return(0,H.fL)(Ke((0,H.OK)(t[0])));case"time":return(0,H.kC)(Le());case"version":return(0,H.kC)(220403);case"tests":return(0,H.fL)(function(e,t=!0){const r=[];for(let t=0;t<(0,n.len)(N);++t){const{name:a,code:s,err:c,out:u}=N[t],o={dict:new Map,output:""},i={funcs:{},vars:{}},l=(0,n.getTimeMs)(),p=e({get:e=>j(o,e),set:(e,t)=>S(o,e,t),print:(e,t)=>{o.output+=e+(t?"\n":"")},exe:(e,t)=>q(o,e,t),functions:{},env:i,loopBudget:1e4,rangeBudget:1e3,callBudget:1e3,recurBudget:1e4},s,s,!0),m="errors"===p.kind?p.errors:[],f=(c||[]).join()===m.map((({e})=>e)).join(),d=!u||(0,n.trim)(o.output)===u,v=(0,n.getTimeMs)()-l,[y,x,h,_,C]=[(0,n.padEnd)(`${t+1}`,3),(0,n.padEnd)(a,24),(0,n.padEnd)(`${(0,n.round)(v)}ms`,6),d||u+"\t!=\t"+(0,n.trim)(o.output),f||m.map((({e,m:t,errCtx:{line:r,col:n}})=>`${e} ${r}:${n}: ${t}`))];r.push({okErr:f,okOut:d,elapsedMs:v,display:`${y} ${x} ${h} ${_} ${C}`})}const a=r.reduce(((e,{elapsedMs:t})=>e+t),0),s=(0,n.len)(r.filter((({okOut:e,okErr:t})=>e&&t)));return(0,n.concat)(r.filter((e=>!t||!e.okOut||!e.okErr)).map((e=>e.display)),[`---- ${s}/${(0,n.len)(r)} tests passed in ${(0,n.round)(a)}ms.`])}(at,!(We(t)&&s(t[0]))).join("\n"));case"symbols":return(0,H.IO)(function(e,t=!0){let r=[];t&&de(r,a.RV),de(r,["args","PI","E"]),r=pe(r,je(a.m3)),r=pe(r,je(e.funcs)),r=pe(r,je(e.vars));const n=["entry"];return r=r.filter((e=>!me(n,e))),he(r,((e,t)=>e>t?1:-1))}(r.env,!1).map(H.fL));case"eval":{delete r.env.funcs.entry;const e=`${c.invokeId} eval`;try{return rt(r,(0,H.Bd)(t[0]),e,[])||(0,H.cC)()}catch(e){Fe(e)&&Xe([{e:"Eval",m:"error within evaluated code",errCtx:c},...e.errors])}}case"about":{const e=(0,H.Bd)(t[0]),r=a.m3[e];if(!r)return(0,H.cC)();const n=[],s=(e,t)=>n.push((0,H.SN)(`:${e}`),t),c=e=>(0,H.IO)(e.map((e=>Ne(e)?(0,H.IO)(e.map(H.fL)):(0,H.fL)(e))));return s("external?",(0,H.Uc)(!!r.external)),r.exactArity?s("exact-arity",(0,H.kC)(r.exactArity)):(r.minArity&&s("minimum-arity",(0,H.kC)(r.minArity)),r.maxArity&&s("maximum-arity",(0,H.kC)(r.maxArity))),(r.params||r.numeric)&&s("in-types",c(r.params?r.params:["num"])),(r.returns||!0===r.numeric)&&s("out-types",c(r.returns?r.returns:["num"])),(0,H.gu)(n)}case"recur":return He=t,(0,H.cC)();case"reset":return r.env.vars={},r.env.funcs={},Ve=[],(0,H.cC)()}return Xe([{e:"Unexpected",m:"operation doesn't exist",errCtx:c}])}(u,t,e,r)}:u in e.env.funcs&&"entry"!==u?t=>tt(e,e.env.funcs[u],t):u in e.env.vars?Qe(e,e.env.vars[u],r):u in ze?Qe(e,ze[u],r):Ae(u,"$")?n=>{if(We(n)||Xe(Je(t.t,r)),!e.set)return Xe([{e:"External",m:'"set" feature not implemented on this platform',errCtx:r}]);const a=e.set(ke(u,1),n[0]);return a&&Xe([{e:"External",m:a,errCtx:r}]),n[0]}:t=>{if(!e.exe)return Xe([{e:"External",m:`operation "${u}" does not exist"`,errCtx:r}]);const n=e.exe(u,t);return"val"===n.kind?n.value:Xe([{e:"External",m:n.err,errCtx:r}])}}if("clo"===t.t)return r=>tt(e,t.v,r);if("key"===t.t)return e=>(We(e)||Xe(Je(t.t,r)),"dict"===e[0].t?(0,H.k1)((0,H.Ay)(e[0]),t):"vec"===e[0].t?(0,H.Bh)(e[0]).find((e=>(0,H.Xy)(e,t)))??(0,H.cC)():Xe(l(r,[e[0].t])));if("num"===t.t){const e=F(t.v);return n=>{We(n)||Xe(Je(t.t,r));const a=n[0];if("str"!==a.t&&"vec"!==a.t&&"dict"!==a.t)return Xe(i(r,[a.t]));const s=(0,H._2)(a),c=We(s);return e>=0&&e>=c||e<0&&-e>c?(0,H.cC)():e<0?s[c+e]:s[e]}}if("vec"===t.t){const{v:e}=t;return n=>(We(n)||Xe(Je(t.t,r)),e.find((e=>(0,H.Xy)(e,n[0])))??(0,H.cC)())}if("dict"===t.t){const e=t.v;return t=>1===We(t)?(0,H.k1)(e,t[0]):2===We(t)?(0,H.L6)((0,H.bd)(e,t[0],t[1])):Xe([{e:"Arity",m:"provide 1 or 2 arguments for dictionary",errCtx:r}])}if("bool"===t.t){const e=t.v;return t=>!We(t)||We(t)>2?Xe([{e:"Arity",m:"provide 1 or 2 arguments for boolean",errCtx:r}]):e?t[0]:We(t)>1?t[1]:(0,H.cC)()}return e=>Xe([{e:"Operation",m:`${(0,H.aP)(t)} is an invalid operation`,errCtx:r}])}function Ze(e){const t=(e,t,r)=>(0,H.bd)(e,(0,H.SN)(t),r);return e.map((({e,m:r,errCtx:n})=>{let a=t({keys:[],vals:[]},":e",(0,H.fL)(e));return a=t(a,":m",(0,H.fL)(r)),a=t(a,":line",(0,H.kC)(n.line)),a=t(a,":col",(0,H.kC)(n.col)),(0,H.L6)(a)}))}function et(e,t){let r=e;for(let e=0,n=We(t)-1;e<n;++e){const a=r[t[e]];if("vec"!==a.t)return"str"===a.t&&e+1===n&&t[e+1]<Ce(a.v)?(0,H.fL)(we(a.v,t[e+1])):(0,H.cC)();r=a.v}const n=t[We(t)-1];return n>=We(r)?(0,H.cC)():r[n]}function tt(e,t,r,n=!1){--e.callBudget,n||(Ve.push({}),ze=Ve[We(Ve)-1]);const c=[];for(let n=0,u=We(t.ins);n<u;++n){const o=t.ins[n],{errCtx:i}=t.ins[n],l=e.loopBudget<1;switch((l||e.callBudget<1)&&Xe([{e:"Budget",m:(l?"looped":"called")+" too many times",errCtx:i}]),o.typ){case"val":c.push(o.value);break;case"var":e.env.vars[o.value]=c[We(c)-1];break;case"let":ze[o.value]=c[We(c)-1];break;case"dle":case"dva":{const t=c.pop();let r;o.value.forEach((({name:n,position:a})=>{r="dva"===o.typ?e.env.vars[n]=et([t],a):ze[n]=et([t],a)})),c.push(r);break}case"npa":case"upa":{const e=o.value;-1===e?c.push((0,H.IO)(r)):We(r)<=e?c.push((0,H.cC)()):c.push(r[e]);break}case"dpa":c.push(et(r,o.value));break;case"ref":{const t=o.value;if(a.m3[t])c.push((0,H.b7)(t));else if(Ae(t,"$")){if(!e.get)return Xe([{e:"External",m:'"get" feature not implemented on this platform',errCtx:i}]);const r=e.get(ke(t,1));if("err"===r.kind)return Xe([{e:"External",m:r.err,errCtx:i}]);c.push(r.value)}else t in e.env.vars?c.push(e.env.vars[t]):t in ze?c.push(ze[t]):t in e.env.funcs?c.push((0,H.b7)(t)):Xe([{e:"Reference",m:`"${t}" did not exist`,errCtx:i}]);break}case"exa":case"exe":{const a=c.pop(),s=Qe(e,a,i,"exa"===o.typ),u=o.value,l=xe(c,We(c)-u,u);try{c.push(s(l))}catch(e){if(Fe(e)){const r=ye(t.ins,n).findIndex((e=>"cat"===e.typ));if(-1!==r){n+=r,ze.errors=(0,H.IO)(Ze(e.errors));break}}throw e}He&&(Ve[We(Ve)-1]={},n=-1,r=He,He=void 0,--e.recurBudget,e.recurBudget||Xe([{e:"Budget",m:"recurred too many times",errCtx:i}]));break}case"or":s(c[We(c)-1])?n+=o.value:c.pop();break;case"mat":{const e=c[We(c)-2];(0,H.Xy)(e,c.pop())?c.pop():n+=o.value;break}case"if":s(c.pop())||(n+=o.value);break;case"jmp":case"cat":n+=o.value;break;case"loo":n+=o.value,--e.loopBudget;break;case"pop":1===o.value?c.pop():xe(c,We(c)-o.value,o.value);break;case"ret":o.value||c.push((0,H.cC)()),n=u;break;case"clo":{const a=ye(o.value.derefs).map((t=>{const r="val"===t.typ&&"str"===t.value.t&&(ze[t.value.v]??e.env.vars[t.value.v]);return r?{typ:"val",value:r}:t})),s=tt(e,{ins:a},r,!0).v,u=ye(t.ins,n+1,n+1+o.value.length);c.push({t:"clo",v:p(o.value,u,s)}),n+=o.value.length;break}default:(0,a.UT)(o)}}return n?(0,H.IO)(c):(Ve.pop(),ze=Ve[We(Ve)-1],c[We(c)-1])}function rt(e,t,r,n){const a=W(t,r);if(We(a.errors)&&Xe(a.errors),e.env.funcs={...e.env.funcs,...a.funcs},"entry"in e.env.funcs)return tt(e,e.env.funcs.entry,n)}function nt(e,t,r){const{callBudget:n,loopBudget:s,recurBudget:c,rangeBudget:u}=e;var o;o=e.functions,Object.keys(o).forEach((e=>{if(a.m3[e]&&!a.m3[e].external)throw"Redefining internal operations is disallowed.";a.m3[e]={...o[e].definition,external:!0}}));let i,l=[];try{i=t()}catch(e){if(!Fe(e))throw e;l=e.errors}return[e.callBudget,e.recurBudget]=[n,c],[e.loopBudget,e.rangeBudget]=[s,u],delete e.env.funcs.entry,Ve=[],We(l)?{kind:"errors",errors:l}:(r&&i&&e.print((0,H.aP)(i),!0),i?{kind:"val",value:i}:{kind:"empty"})}function at(e,t,r,n=!1,a=[]){return nt(e,(()=>rt(e,t,r,a)),n)}const st=new Map,ct=/[\[\]\(\) ,]/;function ut(e,t,r,a=!0){r=r?`-${r}`:`${(0,n.getTimeMs)()}`,st.set(r,t);const s=at(e,t,r,a);return{output:it(s),result:s}}function ot(e,t,r,n=!0){const a=function(e,t,r,n=!1){if(t in e.env.funcs)return nt(e,(()=>tt(e,e.env.funcs[t],r)),n)}(e,t,r,n);return a?{output:it(a),result:a}:{output:[{type:"message",text:`Invoke Error: function '${t}' not found.`}]}}function it(e){if("errors"!==e.kind)return[];let t=[];const r=e=>t.push({type:"message",text:e}),a=e=>t.push({type:"error",text:e});return e.errors.forEach((({e,m:t,errCtx:{line:s,col:c,invokeId:u}})=>{const o=st.get(u);if(!o)return void r(`${e} Error: ${u} line ${s} col ${c}: ${t}\n`);const i=o.split("\n")[s-1],l=(0,n.substr)(i,c-1).split(ct)[0],p=(0,n.trimStart)((0,n.substr)(i,0,c-1)),m=(0,n.starts)(u,"-")?`In ${(0,n.substr)(u,1)}\n`:"";if(r(`\n${(0,n.padEnd)(`${s}`,4)} ${p}`),l){const e=(0,n.substr)(i,c-1+(0,n.slen)(l));a(l),r(`${e}\n`)}else{const e=(0,n.substr)(i,c);a(i[c-1]),r(`${e}\n`)}r(`${e} Error: ${t}.\n${m}`)})),t}},728:(e,t,r)=>{r.r(t),r.d(t,{toNum:()=>n,slice:()=>a,splice:()=>s,len:()=>c,slen:()=>u,isNum:()=>o,isArray:()=>i,substr:()=>l,strIdx:()=>p,sub:()=>m,subIdx:()=>f,has:()=>d,starts:()=>v,ends:()=>y,replace:()=>x,rreplace:()=>h,flat:()=>_,concat:()=>C,push:()=>A,sortBy:()=>b,reverse:()=>g,lowerCase:()=>k,upperCase:()=>O,trim:()=>E,trimStart:()=>P,trimEnd:()=>I,padEnd:()=>B,charCode:()=>w,codeChar:()=>M,randNum:()=>$,randInt:()=>D,range:()=>K,objKeys:()=>L,getTimeMs:()=>T,abs:()=>U,min:()=>R,max:()=>W,sin:()=>j,cos:()=>S,tan:()=>q,sinh:()=>N,cosh:()=>H,tanh:()=>V,asin:()=>z,acos:()=>X,atan:()=>F,sqrt:()=>G,round:()=>J,floor:()=>Y,ceil:()=>Q,sign:()=>Z,logn:()=>ee,log2:()=>te,log10:()=>re});const n=e=>Number(e),a=(e,t,r)=>e.slice(t,r),s=(e,t,r)=>e.splice(t,r),c=e=>e.length,u=e=>e.length,o=e=>""!==e&&!Number.isNaN(Number(e)),i=e=>Array.isArray(e),l=(e,t,r)=>e.substring(t,t+(r??e.length)),p=(e,t)=>e[t],m=(e,t)=>e.includes(t),f=(e,t)=>e.indexOf(t),d=(e,t)=>e.includes(t),v=(e,t)=>e.startsWith(t),y=(e,t)=>e.endsWith(t),x=(e,t,r)=>e.split(t).join(r),h=(e,t,r)=>e.replace(new RegExp(t,"g"),r),_=e=>e.flat(),C=(e,t)=>e.concat(t),A=(e,t)=>e.push(...t),b=(e,t)=>e.sort(t),g=e=>e.reverse(),k=e=>e.toLowerCase(),O=e=>e.toUpperCase(),E=e=>e.trim(),P=e=>e.trimStart(),I=e=>e.trimEnd(),B=(e,t)=>e.padEnd(t),w=e=>e.charCodeAt(0),M=e=>String.fromCharCode(e),$=(e,t)=>e+Math.random()*(t-e),D=(e,t)=>Math.floor($(e,t)),K=e=>[...Array(e).keys()],L=e=>Object.keys(e),T=()=>(new Date).getTime(),U=Math.abs,R=Math.min,W=Math.max,j=Math.sin,S=Math.cos,q=Math.tan,N=Math.sinh,H=Math.cosh,V=Math.tanh,z=Math.asin,X=Math.acos,F=Math.atan,G=Math.sqrt,J=Math.round,Y=Math.floor,Q=Math.ceil,Z=Math.sign,ee=Math.log,te=Math.log2,re=Math.log10},376:(e,t,r)=>{r.d(t,{ib:()=>n,m3:()=>a,RV:()=>s,O3:()=>c,UT:()=>u});const n={env:{funcs:{},vars:{}},loopBudget:1e7,rangeBudget:1e6,callBudget:1e8,recurBudget:1e4},a={print:{returns:["null"]},"print-str":{returns:["null"]},"!":{exactArity:1,returns:["bool"]},"=":{minArity:2,returns:["bool"]},"!=":{minArity:2,returns:["bool"]},"+":{minArity:2,numeric:!0},"-":{minArity:1,numeric:!0},"*":{minArity:2,numeric:!0},"/":{minArity:2,numeric:!0},"//":{minArity:2,numeric:!0},"**":{minArity:1,maxArity:2,numeric:!0},"<":{minArity:2,numeric:!0},">":{minArity:2,numeric:!0},"<=":{minArity:2,numeric:!0},">=":{minArity:2,numeric:!0},"fast=":{exactArity:2},"fast!=":{exactArity:2},"fast+":{exactArity:2,numeric:!0},"fast-":{exactArity:2,numeric:!0},"fast*":{exactArity:2,numeric:!0},"fast/":{exactArity:2,numeric:!0},"fast//":{exactArity:2,numeric:!0},"fast<":{exactArity:2,numeric:!0},"fast>":{exactArity:2,numeric:!0},"fast<=":{exactArity:2,numeric:!0},"fast>=":{exactArity:2,numeric:!0},inc:{exactArity:1,numeric:!0},dec:{exactArity:1,numeric:!0},min:{minArity:2,numeric:!0},max:{minArity:2,numeric:!0},abs:{exactArity:1,numeric:!0},sqrt:{exactArity:1,numeric:!0},round:{minArity:1,maxArity:2,numeric:!0},floor:{exactArity:1,numeric:!0},ceil:{exactArity:1,numeric:!0},logn:{exactArity:1,numeric:!0},log2:{exactArity:1,numeric:!0},log10:{exactArity:1,numeric:!0},and:{minArity:1},or:{minArity:1},xor:{exactArity:2},"&":{exactArity:2,numeric:!0},"|":{exactArity:2,numeric:!0},"^":{exactArity:2,numeric:!0},"~":{exactArity:1,numeric:!0},"<<":{exactArity:2,numeric:!0},">>":{exactArity:2,numeric:!0},">>>":{exactArity:2,numeric:!0},"odd?":{exactArity:1,numeric:"in only",returns:["bool"]},"even?":{exactArity:1,numeric:"in only",returns:["bool"]},"pos?":{exactArity:1,numeric:"in only",returns:["bool"]},"neg?":{exactArity:1,numeric:"in only",returns:["bool"]},"zero?":{exactArity:1,numeric:"in only",returns:["bool"]},"null?":{exactArity:1,returns:["bool"]},"num?":{exactArity:1,returns:["bool"]},"bool?":{exactArity:1,returns:["bool"]},"str?":{exactArity:1,returns:["bool"]},"vec?":{exactArity:1,returns:["bool"]},"dict?":{exactArity:1,returns:["bool"]},"key?":{exactArity:1,returns:["bool"]},"func?":{exactArity:1,returns:["bool"]},"wild?":{exactArity:1,returns:["bool"]},"ext?":{exactArity:1,returns:["bool"]},"type-of":{exactArity:1,returns:["str"]},rem:{minArity:2,numeric:!0},sin:{exactArity:1,numeric:!0},cos:{exactArity:1,numeric:!0},tan:{exactArity:1,numeric:!0},asin:{exactArity:1,numeric:!0},acos:{exactArity:1,numeric:!0},atan:{exactArity:1,numeric:!0},sinh:{exactArity:1,numeric:!0},cosh:{exactArity:1,numeric:!0},tanh:{exactArity:1,numeric:!0},vec:{returns:["vec"]},dict:{returns:["dict"]},len:{exactArity:1,params:[["str","vec","dict"]],returns:["num"]},"to-num":{exactArity:1,params:[["str","num"]],returns:["num","null"]},"to-key":{exactArity:1,params:[["str","num"]],returns:["key"]},"to-vec":{exactArity:1,params:[["str","dict"]],returns:["vec"]},"substr?":{exactArity:2,params:["str","str"],returns:["bool"]},idx:{exactArity:2,params:["any",["str","vec"]],returns:["num"]},"set-at":{exactArity:3,params:["vec","any",["vec","dict"]],returns:["vec","dict"]},map:{minArity:2,returns:["vec"]},for:{minArity:2,returns:["vec"]},reduce:{minArity:2,maxArity:3},reductions:{minArity:2,maxArity:3},filter:{minArity:2,params:["any",["vec","dict","str"]],returns:["vec","str","dict"]},remove:{minArity:2,params:["any",["vec","dict","str"]],returns:["vec","str","dict"]},find:{minArity:2,params:["any",["vec","dict","str"]]},count:{minArity:2,params:["any",["vec","dict","str"]],returns:["num"]},repeat:{minArity:2,params:["any","num"]},str:{returns:["str"]},strn:{returns:["str"]},rand:{maxArity:2,numeric:!0,returns:["num"]},"rand-int":{maxArity:2,numeric:!0,returns:["num"]},".":{minArity:1},"..":{minArity:2},"...":{minArity:2},into:{exactArity:2,params:[["vec","dict"],["vec","dict"]],returns:["vec","dict"]},assoc:{exactArity:3,params:["any","any","dict"],returns:["dict"]},omit:{exactArity:2,params:["any","dict"],returns:["dict"]},insert:{exactArity:3,params:["any","num","vec"],returns:["vec"]},append:{exactArity:2,params:["any","vec"],returns:["vec"]},prepend:{exactArity:2,params:["any","vec"],returns:["vec"]},sect:{minArity:1,maxArity:3,params:[["vec","str"],"num","num"],returns:["vec","str"]},skip:{exactArity:2,params:["num",["vec","str"]],returns:["vec","str"]},first:{exactArity:2,params:["num",["vec","str"]],returns:["vec","str"]},last:{exactArity:2,params:["num",["vec","str"]],returns:["vec","str"]},crop:{exactArity:3,params:["num","num",["vec","str"]],returns:["vec","str"]},reverse:{exactArity:1,params:[["vec","str"]],returns:["vec","str"]},flatten:{exactArity:1,params:["vec"],returns:["vec"]},shuffle:{exactArity:1,params:["vec"],returns:["vec"]},sample:{exactArity:2,params:["num","vec"],returns:["vec"]},sort:{exactArity:1,params:[["vec","str"]],returns:["vec"]},"sort-by":{exactArity:2,params:["any",["vec","dict","str"]],returns:["vec"]},distinct:{returns:["vec"]},"group-by":{exactArity:2,params:["any",["vec","dict","str"]],returns:["dict"]},"part-by":{exactArity:2,params:["any",["vec","dict","str"]],returns:["vec"]},freqs:{exactArity:1,params:[["vec","str"]],returns:["dict"]},keys:{exactArity:1,params:["dict"]},vals:{exactArity:1,params:["dict"]},do:{minArity:1},val:{minArity:1},range:{minArity:1,maxArity:3,numeric:"in only",returns:["vec"]},"empty?":{exactArity:1,params:[["str","vec","dict"]],returns:["bool"]},split:{exactArity:2,params:["str","str"],returns:["vec"]},join:{exactArity:2,params:["str",["vec","dict","str"]],returns:["str"]},replace:{exactArity:3,params:["str","str","str"],returns:["str"]},rreplace:{exactArity:3,params:["str","str","str"],returns:["str"]},"starts?":{exactArity:2,params:["str","str"],returns:["bool"]},"ends?":{exactArity:2,params:["str","str"],returns:["bool"]},"lower-case":{exactArity:1,params:["str"],returns:["str"]},"upper-case":{exactArity:1,params:["str"],returns:["str"]},trim:{exactArity:1,params:["str"],returns:["str"]},"trim-start":{exactArity:1,params:["str"],returns:["str"]},"trim-end":{exactArity:1,params:["str"],returns:["str"]},"str*":{exactArity:2,params:["str","num"],returns:["str"]},"char-code":{minArity:1,maxArity:2,params:[["str","num"],"num"],returns:["str","num","null"]},time:{exactArity:0,returns:["num"]},version:{exactArity:0,returns:["num"]},tests:{minArity:0,maxArity:1,params:["bool"],returns:["str"]},symbols:{exactArity:0,returns:["vec"]},eval:{exactArity:1,params:["str"]},about:{exactArity:1,params:[["str","func"]],returns:["dict"]},reset:{exactArity:0},recur:{}},s=["function","fn","var","let","var!","let!","return","if","if!","when","unless","while","loop","match","catch"],c={null:"null",str:"string",num:"number",bool:"boolean",key:"keyword",ref:"reference",vec:"vector",dict:"dictionary",func:"function",clo:"closure",wild:"wildcard",ext:"external"},u=e=>0},183:(e,t,r)=>{r.d(t,{OK:()=>s,Bd:()=>c,Bh:()=>u,Ay:()=>o,Uc:()=>i,kC:()=>l,fL:()=>p,SN:()=>m,IO:()=>f,L6:()=>d,cC:()=>v,b7:()=>y,Xy:()=>h,Pz:()=>_,aP:()=>C,_2:()=>A,gu:()=>b,k1:()=>g,bd:()=>k,uv:()=>O,WW:()=>E});var n=r(728),a=r(376);const s=({v:e})=>e,c=({v:e})=>e,u=({v:e})=>e,o=({v:e})=>e,i=e=>({t:"bool",v:e}),l=e=>({t:"num",v:e}),p=(e="")=>({t:"str",v:e}),m=e=>({t:"key",v:e}),f=(e=[])=>({t:"vec",v:e}),d=e=>({t:"dict",v:e}),v=()=>({t:"null",v:void 0}),y=e=>({t:"func",v:e}),x=(e,t)=>(0,n.len)(e)===(0,n.len)(t)&&!e.some(((e,r)=>!h(e,t[r]))),h=(e,t)=>{if("wild"===e.t||"wild"===t.t)return!0;if(e.t!==t.t)return!1;switch(e.t){case"null":return!0;case"bool":case"num":return e.v===t.v;case"vec":return x(e.v,u(t));case"dict":{const r=o(t);return(0,n.len)(e.v.keys)===(0,n.len)(r.keys)&&x(e.v.keys,r.keys)}case"str":case"ref":case"key":case"func":return c(e)===c(t);case"clo":return e.v.name===t.v.name;case"ext":return e.v===t.v}return(0,a.UT)(e)},_=e=>e.reduce(((e,t)=>e+C(t)),""),C=e=>{const t=e=>{return"str"===e.t?`"${t=e.v,t.split("").map((e=>'"'===e?'\\"':e)).join("")}"`:C(e);var t};if("clo"===e.t)return e.v.name??"";if("vec"===e.t)return`[${e.v.map(t).join(" ")}]`;if("dict"===e.t){const{keys:r,vals:n}=e.v,[a,s]=[r.map(t),n.map(t)];return`{${a.map(((e,t)=>`${e} ${s[t]}`)).join(", ")}}`}return"null"===e.t?"null":"wild"===e.t?"_":`${e.v}`},A=e=>"vec"===e.t?(0,n.slice)(e.v):"str"===e.t?[...e.v].map((e=>({t:"str",v:e}))):"dict"===e.t?e.v.keys.map(((t,r)=>({t:"vec",v:[t,e.v.vals[r]]}))):[],b=e=>{(0,n.len)(e)%2==1&&e.pop();const t=e.filter(((e,t)=>t%2==0)),r=e.filter(((e,t)=>t%2==1)),a=[],s=[];return t.forEach(((e,t)=>{const n=a.findIndex((t=>h(t,e)));-1===n?(a.push(e),s.push(r[t])):s[n]=r[t]})),{t:"dict",v:{keys:a,vals:s}}},g=({keys:e,vals:t},r)=>{const n=e.findIndex((e=>h(e,r)));return-1===n?{t:"null",v:void 0}:t[n]},k=({keys:e,vals:t},r,a)=>{const[s,c]=[(0,n.slice)(e),(0,n.slice)(t)],u=e.findIndex((e=>h(e,r)));return-1!==u?c[u]=a:(s.push(r),c.push(a)),{keys:s,vals:c}},O=({keys:e,vals:t},r)=>{const[a,s]=[(0,n.slice)(e),(0,n.slice)(t)],c=e.findIndex((e=>h(e,r)));return-1!==c&&((0,n.splice)(a,c,1),(0,n.splice)(s,c,1)),{t:"dict",v:{keys:a,vals:s}}};function E(e,t,r){if(!(0,n.len)(e)||"vec"!==r.t&&"dict"!==r.t||"vec"===r.t&&("num"!==e[0].t||e[0].v<0||e[0].v>(0,n.len)(r.v)))return r;if("vec"===r.t){const a=(0,n.slice)(r.v),c=s(e[0]);return 1===(0,n.len)(e)?(a[c]=t,{t:"vec",v:a}):(a[c]=E((0,n.slice)(e,1),t,a[c]),{t:"vec",v:a})}return 1===(0,n.len)(e)?{t:"dict",v:k(r.v,e[0],t)}:{t:"dict",v:k(r.v,e[0],E((0,n.slice)(e,1),t,g(r.v,e[0])))}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{var _invoker__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(223),_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(376),_val__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(183);const e=e=>document.querySelector(e);let state=new Map;const get=e=>state.has(e)?{kind:"val",value:state.get(e)}:nullValOrErr,set=(e,t)=>{state.set(e,t),localStorage.setItem("insitux-state",JSON.stringify([...state.entries()]))};function exe(e,t){return t.length&&"str"==t[0].t&&t[0].v.startsWith("$")?1===t.length?get(`${t[0].v.substring(1)}.${e}`):(set(`${t[0].v.substring(1)}.${e}`,t[1]),{kind:"val",value:t[1]}):{kind:"err",err:`operation ${e} does not exist`}}function fetchOp(e,t,r,n){setTimeout((async()=>{let a;try{a={t:"str",v:await(await fetch(e,{method:t,body:n})).text()}}catch(e){a={t:"null",v:void 0}}alertErrors((0,_invoker__WEBPACK_IMPORTED_MODULE_0__.Ux)(ctx,r,[a]))}))}function htmlToElement(e){let t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}const nullValOrErr={kind:"val",value:(0,_val__WEBPACK_IMPORTED_MODULE_2__.cC)()},v2e=t=>"str"===t.t?e(t.v):t.v,functions={js:{definition:{minArity:1,params:["str"]},handler:params=>{try{const evaluated=eval((0,_val__WEBPACK_IMPORTED_MODULE_2__.Bd)(params[0])),v="function"==typeof evaluated?evaluated(params.slice(1).map((e=>e.v))):evaluated;let value={t:"ext",v};return"string"==typeof v&&(value=(0,_val__WEBPACK_IMPORTED_MODULE_2__.fL)(v)),{kind:"val",value}}catch(e){return{kind:"err",err:`${e}`}}}},"inner-html":{definition:{exactArity:2,params:[["str","ext"]],returns:["str"]},handler:([e,t])=>{const r=v2e(e);return r&&(r.innerHTML=(0,_val__WEBPACK_IMPORTED_MODULE_2__.aP)(t)),nullValOrErr}},"html-el":{definition:{exactArity:1,returns:["ext"]},handler:([e])=>({kind:"val",value:{t:"ext",v:htmlToElement((0,_val__WEBPACK_IMPORTED_MODULE_2__.aP)(e))}})},"child-at":{definition:{exactArity:2,params:[["str","ext"],"num"],returns:["ext","null"]},handler:([e,t])=>{const r=v2e(e)?.childNodes[(0,_val__WEBPACK_IMPORTED_MODULE_2__.OK)(t)];return{kind:"val",value:r?{t:"ext",v:r}:(0,_val__WEBPACK_IMPORTED_MODULE_2__.cC)()}}},"append-child":{definition:{exactArity:2,params:[["str","ext"],"ext"],returns:["null"]},handler:([e,t])=>(v2e(e)?.appendChild(t.v),nullValOrErr)},"remove-child":{definition:{exactArity:2,params:[["str","ext"],"num"],returns:["null"]},handler:([e,t])=>{if("str"===e.t){const r=v2e(e);r?.removeChild(r.childNodes[(0,_val__WEBPACK_IMPORTED_MODULE_2__.OK)(t)])}return nullValOrErr}},"replace-child":{definition:{exactArity:3,params:[["str","ext"],"ext","num"],returns:["null"]},handler:([e,t,r])=>{const[n,a]=[v2e(e),v2e(t)],s=n?.childNodes[(0,_val__WEBPACK_IMPORTED_MODULE_2__.OK)(r)];return n&&a&&s&&n.replaceChild(a,s),nullValOrErr}},prompt:{definition:{exactArity:1,returns:["str","null"]},handler:e=>{const t=prompt((0,_val__WEBPACK_IMPORTED_MODULE_2__.aP)(e[0]));return{kind:"val",value:t?(0,_val__WEBPACK_IMPORTED_MODULE_2__.fL)(t):(0,_val__WEBPACK_IMPORTED_MODULE_2__.cC)()}}},alert:{definition:{exactArity:1,returns:["null"]},handler:e=>(alert((0,_val__WEBPACK_IMPORTED_MODULE_2__.aP)(e[0])),nullValOrErr)},interval:{definition:{exactArity:2,params:["func","num"],returns:["null"]},handler:([e,t])=>(setInterval((()=>(0,_invoker__WEBPACK_IMPORTED_MODULE_0__.zm)(ctx,`(${e.v})`)),(0,_val__WEBPACK_IMPORTED_MODULE_2__.OK)(t)),nullValOrErr)},timeout:{definition:{exactArity:2,params:["func","num"],returns:["null"]},handler:([e,t])=>(setTimeout((()=>(0,_invoker__WEBPACK_IMPORTED_MODULE_0__.zm)(ctx,`(${e.v})`)),(0,_val__WEBPACK_IMPORTED_MODULE_2__.OK)(t)),nullValOrErr)},"GET-str":{definition:{exactArity:2,params:["func","str"],returns:["str"]},handler:([e,t])=>(fetchOp((0,_val__WEBPACK_IMPORTED_MODULE_2__.Bd)(t),"GET",(0,_val__WEBPACK_IMPORTED_MODULE_2__.Bd)(e)),nullValOrErr)},"POST-str":{definition:{exactArity:3,params:["func","str","str"],returns:["str"]},handler:([e,t,r])=>(fetchOp((0,_val__WEBPACK_IMPORTED_MODULE_2__.Bd)(t),"POST",(0,_val__WEBPACK_IMPORTED_MODULE_2__.Bd)(e),(0,_val__WEBPACK_IMPORTED_MODULE_2__.Bd)(r)),nullValOrErr)}},ctx={..._types__WEBPACK_IMPORTED_MODULE_1__.ib,exe,get,set,print:e=>console.log(e),functions},loadScript=async e=>{const t=e.src?await(await fetch(e.src)).text():e.innerHTML;window.ix(t)};function alertErrors({output:e}){if(e.length>0){const t=e.map((({type:e,text:t})=>"error"===e?[...t,""].join(""):t));alert(`---- Insitux\n${t.join("")}`)}}window.onload=async()=>{const e=localStorage.getItem("insitux-state");state=new Map(e?JSON.parse(e):[]),console.log(state);const t=Array.from(document.querySelectorAll("script")).filter((e=>"text/insitux"===e.type));for(let e=0;e<t.length;++e)await loadScript(t[e])},window.ix=e=>alertErrors((0,_invoker__WEBPACK_IMPORTED_MODULE_0__.zm)(ctx,e))})()})();
//# sourceMappingURL=insitux.min.js.map